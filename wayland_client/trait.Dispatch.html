<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="A trait providing an implementation for handling events a proxy through an [`EventQueue`]."><meta name="keywords" content="rust, rustlang, rust-lang, Dispatch"><title>Dispatch in wayland_client - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../dark.css" disabled><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script defer src="sidebar-items.js"></script><script defer src="../main.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../wayland_client/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div></a><h2 class="location"></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../wayland_client/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div></a><h2 class="location"><a href="#">Dispatch</a></h2><div class="sidebar-elems"><section><div class="block"><h3 class="sidebar-title"><a href="#required-methods">Required Methods</a></h3><ul><li><a href="#tymethod.event">event</a></li></ul></div><div class="block"><h3 class="sidebar-title"><a href="#provided-methods">Provided Methods</a></h3><ul><li><a href="#method.event_created_child">event_created_child</a></li></ul></div><div class="block"><h3 class="sidebar-title"><a href="#implementors">Implementors</a></h3></div></section><h2 class="location"><a href="index.html">In wayland_client</a></h2></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../wayland_client/index.html"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../wheel.svg"></a></div></div></form></nav></div><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn"><span class="in-band">Trait <a href="index.html">wayland_client</a>::<wbr><a class="trait" href="#">Dispatch</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../src/wayland_client/event_queue.rs.html#92-130">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><div class="docblock item-decl"><pre class="rust trait"><code>pub trait Dispatch&lt;I, UserData, State&nbsp;=&nbsp;Self&gt; <span class="where fmt-newline">where<br>&nbsp;&nbsp;&nbsp;&nbsp;Self: <a class="trait" href="https://doc.rust-lang.org/1.64.0/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,<br>&nbsp;&nbsp;&nbsp;&nbsp;I: <a class="trait" href="trait.Proxy.html" title="trait wayland_client::Proxy">Proxy</a>,<br>&nbsp;&nbsp;&nbsp;&nbsp;State: <a class="trait" href="trait.Dispatch.html" title="trait wayland_client::Dispatch">Dispatch</a>&lt;I, UserData, State&gt;,&nbsp;</span>{
    fn <a href="#tymethod.event" class="fnname">event</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;state: <a class="primitive" href="https://doc.rust-lang.org/1.64.0/std/primitive.reference.html">&amp;mut </a>State,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy: <a class="primitive" href="https://doc.rust-lang.org/1.64.0/std/primitive.reference.html">&amp;</a>I,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event: I::<a class="associatedtype" href="trait.Proxy.html#associatedtype.Event" title="type wayland_client::Proxy::Event">Event</a>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data: <a class="primitive" href="https://doc.rust-lang.org/1.64.0/std/primitive.reference.html">&amp;</a>UserData,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn: &amp;<a class="struct" href="struct.Connection.html" title="struct wayland_client::Connection">Connection</a>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qhandle: &amp;<a class="struct" href="struct.QueueHandle.html" title="struct wayland_client::QueueHandle">QueueHandle</a>&lt;State&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;);

    fn <a href="#method.event_created_child" class="fnname">event_created_child</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opcode: <a class="primitive" href="https://doc.rust-lang.org/1.64.0/std/primitive.u16.html">u16</a>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_qhandle: &amp;<a class="struct" href="struct.QueueHandle.html" title="struct wayland_client::QueueHandle">QueueHandle</a>&lt;State&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.64.0/alloc/sync/struct.Arc.html" title="struct alloc::sync::Arc">Arc</a>&lt;dyn <a class="trait" href="backend/trait.ObjectData.html" title="trait wayland_client::backend::ObjectData">ObjectData</a>&gt; { ... }
}</code></pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>A trait providing an implementation for handling events a proxy through an <a href="struct.EventQueue.html" title="EventQueue"><code>EventQueue</code></a>.</p>
<h3 id="general-usage"><a href="#general-usage">General usage</a></h3>
<p>You need to implement this trait on your <code>State</code> for every type of Wayland object that will be processed
by the <a href="struct.EventQueue.html" title="EventQueue"><code>EventQueue</code></a> working with your <code>State</code>.</p>
<p>You can have different implementations of the trait for the same interface but different <code>UserData</code> type,
this way the events for a given object will be processed by the adequate implementation depending on
which <code>UserData</code> was assigned to it at creation.</p>
<p>The way this trait works is that the <a href="trait.Dispatch.html#tymethod.event" title="Dispatch::event()"><code>Dispatch::event()</code></a> method will be invoked by the event queue for
every event received by an object associated to this event queue. Your implementation can then match on
the associated <a href="trait.Proxy.html#associatedtype.Event" title="Proxy::Event"><code>Proxy::Event</code></a> enum and do any processing needed with that event.</p>
<p>In the rare case of an interface with <em>events</em> creating new objects (in the core protocol, the only
instance of this is the <code>wl_data_device.data_offer</code> event), you’ll need to implement the
<a href="trait.Dispatch.html#method.event_created_child" title="Dispatch::event_created_child()"><code>Dispatch::event_created_child()</code></a> method. See the <a href="event_created_child!"><code>event_created_child!</code></a> macro
for a simple way to do this.</p>
<h3 id="modularity"><a href="#modularity">Modularity</a></h3>
<p>To provide generic handlers for downstream usage, it is possible to make an implementation of the trait
that is generic over the last type argument, as illustrated below. Users will then be able to
automatically delegate their implementation to yours using the [<code>delegate_dispatch!</code>] macro.</p>
<p>As a result, when your implementation is instanciated, the last type parameter <code>State</code> will be the state
struct of the app using your generic implementation. You can put additional trait constraints on it to
specify an interface between your module and downstream code, as illustrated in this example:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">wayland_client</span>::{<span class="ident">protocol::wl_registry</span>, <span class="ident">Dispatch</span>};

<span class="doccomment">/// The type we want to delegate to</span>
<span class="kw">struct</span> <span class="ident">DelegateToMe</span>;

<span class="doccomment">/// The user data relevant for your implementation.</span>
<span class="doccomment">/// When providing delegate implementation, it is recommended to use your own type here, even if it is</span>
<span class="doccomment">/// just a unit struct: using () would cause a risk of clashing with an other such implementation.</span>
<span class="kw">struct</span> <span class="ident">MyUserData</span>;

<span class="comment">// Now a generic implementation of Dispatch, we are generic over the last type argument instead of using</span>
<span class="comment">// the default State=Self.</span>
<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">State</span><span class="op">&gt;</span> <span class="ident">Dispatch</span><span class="op">&lt;</span><span class="ident">wl_registry::WlRegistry</span>, <span class="ident">MyUserData</span>, <span class="ident">State</span><span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">DelegateToMe</span>
<span class="kw">where</span>
    <span class="comment">// State is the type which has delegated to this type, so it needs to have an impl of Dispatch itself</span>
    <span class="ident">State</span>: <span class="ident">Dispatch</span><span class="op">&lt;</span><span class="ident">wl_registry::WlRegistry</span>, <span class="ident">MyUserData</span><span class="op">&gt;</span>,
    <span class="comment">// If your delegate type has some internal state, it&#39;ll need to access it, and you can</span>
    <span class="comment">// require it by adding custom trait bounds.</span>
    <span class="comment">// In this example, we just require an AsMut implementation</span>
    <span class="ident">State</span>: <span class="ident">AsMut</span><span class="op">&lt;</span><span class="ident">DelegateToMe</span><span class="op">&gt;</span>,
{
    <span class="kw">fn</span> <span class="ident">event</span>(
        <span class="ident">state</span>: <span class="kw-2">&amp;mut</span> <span class="ident">State</span>,
        <span class="ident">_proxy</span>: <span class="kw-2">&amp;</span><span class="ident">wl_registry::WlRegistry</span>,
        <span class="ident">_event</span>: <span class="ident">wl_registry::Event</span>,
        <span class="ident">_udata</span>: <span class="kw-2">&amp;</span><span class="ident">MyUserData</span>,
        <span class="ident">_conn</span>: <span class="kw-2">&amp;</span><span class="ident">wayland_client::Connection</span>,
        <span class="ident">_qhandle</span>: <span class="kw-2">&amp;</span><span class="ident">wayland_client::QueueHandle</span><span class="op">&lt;</span><span class="ident">State</span><span class="op">&gt;</span>,
    ) {
        <span class="comment">// Here the delegate may handle incoming events as it pleases.</span>

        <span class="comment">// For example, it retrives its state and does some processing with it</span>
        <span class="kw">let</span> <span class="ident">me</span>: <span class="kw-2">&amp;mut</span> <span class="ident">DelegateToMe</span> <span class="op">=</span> <span class="ident">state</span>.<span class="ident">as_mut</span>();
        <span class="comment">// do something with `me` ...</span>
    }
}</code></pre></div>
<p><strong>Note:</strong> Due to limitations in Rust’s trait resolution algorithm, a type providing a generic
implementation of <a href="trait.Dispatch.html" title="Dispatch"><code>Dispatch</code></a> cannot be used directly as the dispatching state, as rustc
currently fails to understand that it also provides <code>Dispatch&lt;I, U, Self&gt;</code> (assuming all other
trait bounds are respected as well).</p>
</div></details><h2 id="required-methods" class="small-section-header">Required Methods<a href="#required-methods" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="tymethod.event" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/wayland_client/event_queue.rs.html#109-116">source</a></div><h4 class="code-header">fn <a href="#tymethod.event" class="fnname">event</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;state: <a class="primitive" href="https://doc.rust-lang.org/1.64.0/std/primitive.reference.html">&amp;mut </a>State,<br>&nbsp;&nbsp;&nbsp;&nbsp;proxy: <a class="primitive" href="https://doc.rust-lang.org/1.64.0/std/primitive.reference.html">&amp;</a>I,<br>&nbsp;&nbsp;&nbsp;&nbsp;event: I::<a class="associatedtype" href="trait.Proxy.html#associatedtype.Event" title="type wayland_client::Proxy::Event">Event</a>,<br>&nbsp;&nbsp;&nbsp;&nbsp;data: <a class="primitive" href="https://doc.rust-lang.org/1.64.0/std/primitive.reference.html">&amp;</a>UserData,<br>&nbsp;&nbsp;&nbsp;&nbsp;conn: &amp;<a class="struct" href="struct.Connection.html" title="struct wayland_client::Connection">Connection</a>,<br>&nbsp;&nbsp;&nbsp;&nbsp;qhandle: &amp;<a class="struct" href="struct.QueueHandle.html" title="struct wayland_client::QueueHandle">QueueHandle</a>&lt;State&gt;<br>)</h4></div></summary><div class="docblock"><p>Called when an event from the server is processed</p>
<p>This method contains your logic for processing events, which can vary wildly from an object to the
other. You are given as argument:</p>
<ul>
<li>a proxy representing the object that received this event</li>
<li>the event itself as the <a href="trait.Proxy.html#associatedtype.Event" title="Proxy::Event"><code>Proxy::Event</code></a> enum (which you’ll need to match against)</li>
<li>a reference to the <code>UserData</code> that was associated with that object on creation</li>
<li>a reference to the <a href="struct.Connection.html" title="Connection"><code>Connection</code></a> in case you need to access it</li>
<li>a reference to a <a href="struct.QueueHandle.html" title="QueueHandle"><code>QueueHandle</code></a> associated with the <a href="struct.EventQueue.html" title="EventQueue"><code>EventQueue</code></a> currently processing events, in
case you need to create new objects that you want associated to the same <a href="struct.EventQueue.html" title="EventQueue"><code>EventQueue</code></a>.</li>
</ul>
</div></details></div><h2 id="provided-methods" class="small-section-header">Provided Methods<a href="#provided-methods" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="method.event_created_child" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/wayland_client/event_queue.rs.html#123-129">source</a></div><h4 class="code-header">fn <a href="#method.event_created_child" class="fnname">event_created_child</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;opcode: <a class="primitive" href="https://doc.rust-lang.org/1.64.0/std/primitive.u16.html">u16</a>,<br>&nbsp;&nbsp;&nbsp;&nbsp;_qhandle: &amp;<a class="struct" href="struct.QueueHandle.html" title="struct wayland_client::QueueHandle">QueueHandle</a>&lt;State&gt;<br>) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.64.0/alloc/sync/struct.Arc.html" title="struct alloc::sync::Arc">Arc</a>&lt;dyn <a class="trait" href="backend/trait.ObjectData.html" title="trait wayland_client::backend::ObjectData">ObjectData</a>&gt;</h4></div></summary><div class="docblock"><p>Method used to initialize the user-data of objects created by events</p>
<p>If the interface does not have any such event, you can ignore it. If not, the
<a href="event_created_child!"><code>event_created_child!</code></a> macro is provided for overriding it.</p>
</div></details></div><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor"></a></h2><div class="item-list" id="implementors-list"></div><script type="text/javascript" src="../implementors/wayland_client/event_queue/trait.Dispatch.js" data-ignore-extern-crates="" async></script></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="wayland_client" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.64.0 (a55dd71d5 2022-09-19)" ></div></body></html>